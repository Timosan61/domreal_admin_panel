# üìã Creatium - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

## üîç –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

Creatium –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ **2 —Ñ–æ—Ä–º–∞—Ç–∞—Ö**:

### 1Ô∏è‚É£ JSON (application/json)
```json
{
  "site": {
    "name": "–ú–∞—Ä–∏–Ω–∞-–ì–∞—Ä–¥–µ–Ω",
    "url": "https://marinagardensochi.ru"
  },
  "page": {
    "name": "–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"
  },
  "order": {
    "form_name": "–ë–õ–û–ö –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
    "fields": {
      "–ò–º—è": "–õ–µ–Ω–∞",
      "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞": "+7 (904) 421-45-85"
    }
  }
}
```

### 2Ô∏è‚É£ Form-urlencoded (application/x-www-form-urlencoded)
```
site[name]=–ú–∞—Ä–∏–Ω–∞-–ì–∞—Ä–¥–µ–Ω&
site[url]=https://marinagardensochi.ru&
page[name]=–ì–ª–∞–≤–Ω–∞—è&
order[form_name]=–ë–õ–û–ö –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ&
order[fields_by_name][–ò–º—è]=–õ–µ–Ω–∞&
order[fields_by_name][–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞]=+7 (904) 421-45-85
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å form-urlencoded:**
- –ü–æ–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `order[fields_by_name]` (–Ω–µ `order[fields]`)
- PHP `parse_str()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –º–∞—Å—Å–∏–≤—ã

---

## üìû –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

**–§–∞–π–ª:** `webhook/creatium.php` ‚Üí `extractPhone()`

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—É—Ç–∏:**

1. `order.fields['–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞']` (JSON)
2. `order.fields['phone']` (JSON, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
3. `order.fields_by_name['–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞']` (form-urlencoded) ‚úÖ **–û–°–ù–û–í–ù–û–ô**
4. `order.fields_by_name['phone']` (form-urlencoded, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
5. –ú–∞—Å—Å–∏–≤ `order.fields[]` —Å –ø–æ–∏—Å–∫–æ–º –ø–æ `name` (JSON, –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤)

**–ü—Ä–∏–º–µ—Ä—ã —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç:**
```
"+7 (904) 421-45-85"  ‚Üí –æ—á–∏—â–∞–µ—Ç—Å—è ‚Üí "79044214585"
"+79991234567"        ‚Üí –æ—á–∏—â–∞–µ—Ç—Å—è ‚Üí "79991234567"
"8 (999) 123-45-67"   ‚Üí –æ—á–∏—â–∞–µ—Ç—Å—è ‚Üí "89991234567"
" 7 (904) 421-45-85"  ‚Üí –æ—á–∏—â–∞–µ—Ç—Å—è ‚Üí "79044214585" (—Å –ø—Ä–æ–±–µ–ª–æ–º –≤ –Ω–∞—á–∞–ª–µ!)
```

---

## ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤

**–§–∞–π–ª:** `lidtracker/classes/WebhookReceiver.php` ‚Üí `validatePhone()`

**–û–±—â–∞—è –¥–ª—è –≤—Å–µ—Ö webhook** (Creatium, GCK, Marquiz).

### –ê–ª–≥–æ—Ä–∏—Ç–º:

1. **–û—á–∏—Å—Ç–∫–∞:** –£–¥–∞–ª—è–µ–º –≤—Å—ë –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
   ```php
   $cleaned = preg_replace('/\D/', '', $phone);
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞:**

#### ‚úÖ –§–æ—Ä–º–∞—Ç 1: –†–æ—Å—Å–∏–π—Å–∫–∏–π –Ω–æ–º–µ—Ä +7XXXXXXXXXX
```
–£—Å–ª–æ–≤–∏–µ: strlen($cleaned) === 11 && $cleaned[0] === '7'
–ü—Ä–∏–º–µ—Ä—ã:
  "+7 (904) 421-45-85" ‚Üí "79044214585" ‚úÖ
  "79261234567"        ‚Üí "79261234567" ‚úÖ
  " 7 (999) 123-45-67" ‚Üí "79991234567" ‚úÖ

–†–µ–∑—É–ª—å—Ç–∞—Ç: "+79044214585"
```

#### ‚úÖ –§–æ—Ä–º–∞—Ç 2: –ë–µ–∑ +7 (9XXXXXXXXX)
```
–£—Å–ª–æ–≤–∏–µ: strlen($cleaned) === 10 && $cleaned[0] === '9'
–ü—Ä–∏–º–µ—Ä—ã:
  "9261234567"         ‚Üí "9261234567"  ‚úÖ
  "(926) 123-45-67"    ‚Üí "9261234567"  ‚úÖ

–†–µ–∑—É–ª—å—Ç–∞—Ç: "+79261234567"
```

#### ‚úÖ –§–æ—Ä–º–∞—Ç 3: –¢–ï–°–¢–û–í–´–ô (–ª—é–±—ã–µ 11 —Ü–∏—Ñ—Ä)
```
–£—Å–ª–æ–≤–∏–µ: strlen($cleaned) === 11
–ü—Ä–∏–º–µ—Ä—ã:
  "11111111111"        ‚Üí "11111111111" ‚úÖ
  "89991234567"        ‚Üí "89991234567" ‚úÖ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 8!)
  "12345678901"        ‚Üí "12345678901" ‚úÖ

–†–µ–∑—É–ª—å—Ç–∞—Ç: "+11111111111" –∏–ª–∏ "+89991234567"
```

#### ‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```
–£—Å–ª–æ–≤–∏–µ: –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –Ω–∏ –ø–æ–¥ –æ–¥–∏–Ω —Ñ–æ—Ä–º–∞—Ç
–ü—Ä–∏–º–µ—Ä—ã:
  "123"                ‚Üí "123"         ‚ùå (—Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π)
  "999123456"          ‚Üí "999123456"   ‚ùå (9 —Ü–∏—Ñ—Ä)

–û—à–∏–±–∫–∞: "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –û–∂–∏–¥–∞–µ—Ç—Å—è: +79XXXXXXXXX –∏–ª–∏ 11 —Ü–∏—Ñ—Ä"
```

---

## üß™ –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (—Ä–µ–∞–ª—å–Ω—ã–π Creatium)
```
–§–æ—Ä–º–∞—Ç: form-urlencoded
–¢–µ–ª–µ—Ñ–æ–Ω: "+7 (904) 421-45-85"
–û—á–∏—Å—Ç–∫–∞: "79044214585"
–í–∞–ª–∏–¥–∞—Ü–∏—è: ‚úÖ –§–æ—Ä–º–∞—Ç 1
–†–µ–∑—É–ª—å—Ç–∞—Ç: +79044214585
```

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (—Ç–µ—Å—Ç –∏–∑ –ø–∞–Ω–µ–ª–∏ Creatium)
```
–§–æ—Ä–º–∞—Ç: form-urlencoded
–¢–µ–ª–µ—Ñ–æ–Ω: "+7 (999) 123-45-67"
–û—á–∏—Å—Ç–∫–∞: "79991234567"
–í–∞–ª–∏–¥–∞—Ü–∏—è: ‚úÖ –§–æ—Ä–º–∞—Ç 1
–†–µ–∑—É–ª—å—Ç–∞—Ç: +79991234567
```

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (—Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)
```
–§–æ—Ä–º–∞—Ç: JSON
–¢–µ–ª–µ—Ñ–æ–Ω: "11111111111"
–û—á–∏—Å—Ç–∫–∞: "11111111111"
–í–∞–ª–∏–¥–∞—Ü–∏—è: ‚úÖ –§–æ—Ä–º–∞—Ç 3 (—Ç–µ—Å—Ç–æ–≤—ã–π)
–†–µ–∑—É–ª—å—Ç–∞—Ç: +11111111111
```

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (–Ω–æ–º–µ—Ä —Å 8)
```
–§–æ—Ä–º–∞—Ç: form-urlencoded
–¢–µ–ª–µ—Ñ–æ–Ω: "8 (999) 123-45-67"
–û—á–∏—Å—Ç–∫–∞: "89991234567"
–í–∞–ª–∏–¥–∞—Ü–∏—è: ‚úÖ –§–æ—Ä–º–∞—Ç 3 (—Ç–µ—Å—Ç–æ–≤—ã–π, 11 —Ü–∏—Ñ—Ä)
–†–µ–∑—É–ª—å—Ç–∞—Ç: +89991234567
```

### ‚ùå –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç
```
–§–æ—Ä–º–∞—Ç: –ª—é–±–æ–π
–¢–µ–ª–µ—Ñ–æ–Ω: "999-123-456" (9 —Ü–∏—Ñ—Ä)
–û—á–∏—Å—Ç–∫–∞: "999123456"
–í–∞–ª–∏–¥–∞—Ü–∏—è: ‚ùå –û—à–∏–±–∫–∞
–ü—Ä–∏—á–∏–Ω–∞: –ú–µ–Ω—å—à–µ 10 —Ü–∏—Ñ—Ä
```

---

## üîß –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç—å** –≤–∞–ª–∏–¥–∞—Ü–∏—é (–ø—Ä–∏–Ω–∏–º–∞—Ç—å –ª—é–±—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã):

**–§–∞–π–ª:** `lidtracker/classes/WebhookReceiver.php`

**–ó–∞–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥ `validatePhone()`:**
```php
private function validatePhone($phone) {
    $cleaned = preg_replace('/\D/', '', $phone);

    // –†–ï–ñ–ò–ú –û–¢–õ–ê–î–ö–ò: –ü—Ä–∏–Ω–∏–º–∞–µ–º –í–°–Å
    if (strlen($cleaned) >= 10) {
        // –î–æ–±–∞–≤–ª—è–µ–º + –µ—Å–ª–∏ –Ω–µ—Ç
        $normalized = '+' . $cleaned;
        return [
            'valid' => true,
            'normalized' => $normalized
        ];
    }

    return [
        'valid' => false,
        'error' => '–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –Ω–æ–º–µ—Ä (–º–∏–Ω–∏–º—É–º 10 —Ü–∏—Ñ—Ä)'
    ];
}
```

**‚ö†Ô∏è –ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –¥–ª—è production (–±—É–¥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –Ω–æ–º–µ—Ä–∞).

---

## üìä –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### ‚úÖ –ß—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è:

| –§–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ | –ü—Ä–∏–º–µ—Ä | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|-----------------|--------|-----------|
| –†–æ—Å—Å–∏–π—Å–∫–∏–π +7 | `+7 (904) 421-45-85` | ‚úÖ `+79044214585` |
| –†–æ—Å—Å–∏–π—Å–∫–∏–π –±–µ–∑ +7 | `9261234567` | ‚úÖ `+79261234567` |
| –° –≤–æ—Å—å–º—ë—Ä–∫–æ–π | `8 (999) 123-45-67` | ‚úÖ `+89991234567` |
| –¢–µ—Å—Ç–æ–≤—ã–π (11 —Ü–∏—Ñ—Ä) | `11111111111` | ‚úÖ `+11111111111` |
| –õ—é–±—ã–µ 11 —Ü–∏—Ñ—Ä | `12345678901` | ‚úÖ `+12345678901` |

### ‚ùå –ß—Ç–æ –ù–ï –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è:

| –§–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ | –ü—Ä–∏–º–µ—Ä | –ü—Ä–∏—á–∏–Ω–∞ |
|-----------------|--------|---------|
| –ö–æ—Ä–æ—Ç–∫–∏–π | `999123456` (9 —Ü–∏—Ñ—Ä) | ‚ùå –ú–µ–Ω—å—à–µ 10 —Ü–∏—Ñ—Ä |
| –û—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–π | `12345` | ‚ùå –ú–µ–Ω—å—à–µ 10 —Ü–∏—Ñ—Ä |
| –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –±–µ–∑ –†–æ—Å—Å–∏–∏ | `14155551234` (–°–®–ê, 11 —Ü–∏—Ñ—Ä) | ‚úÖ –ü–†–ò–ù–ò–ú–ê–ï–¢–°–Ø (—Ñ–æ—Ä–º–∞—Ç 3) |

---

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç–µ—Å—Ç–∞:
```bash
curl -X POST http://195.239.161.77:18080/webhook/creatium.php \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d 'site[name]=–¢–µ—Å—Ç–æ–≤—ã–π —Å–∞–π—Ç&order[fields_by_name][–ò–º—è]=–¢–µ—Å—Ç&order[fields_by_name][–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞]=+7 (999) 123-45-67'
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```json
{
  "success": true,
  "lead_id": "44",
  "message": "Lead received and queued for processing"
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ:
```bash
php check_lead_details.php 44
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –º–æ–Ω–∏—Ç–æ—Ä–µ:
http://195.239.161.77:18080/webhook/monitor.php

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ü—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ:** Creatium –∏–Ω–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω —Å –ø—Ä–æ–±–µ–ª–æ–º –≤ –Ω–∞—á–∞–ª–µ ` 7 (904)...` - —ç—Ç–æ **–Ω–æ—Ä–º–∞–ª—å–Ω–æ**, `preg_replace('/\D/', '')` —É–¥–∞–ª—è–µ—Ç –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã.

2. **–°–∫–æ–±–∫–∏ –∏ –¥–µ—Ñ–∏—Å—ã:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ.

3. **–§–æ—Ä–º–∞—Ç 8XXXXXXXXXX:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ "–§–æ—Ä–º–∞—Ç 3" (–ª—é–±—ã–µ 11 —Ü–∏—Ñ—Ä), —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ `+89991234567`.

4. **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º:** –¢–µ–∫—É—â–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è **—É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç** —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–§–æ—Ä–º–∞—Ç 3) - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±—ã–µ 11 —Ü–∏—Ñ—Ä.

5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:** –í Creatium **–ù–ï–¢** –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ `isTestRequest()` (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç GCK).

---

**–î–∞—Ç–∞:** 2025-10-27 21:00
**–í–µ—Ä—Å–∏—è:** Production + —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
**–°—Ç–∞—Ç—É—Å:** üü¢ –í–°–Å –†–ê–ë–û–¢–ê–ï–¢
