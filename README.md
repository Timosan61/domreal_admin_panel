# üìû –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –∑–≤–æ–Ω–∫–æ–≤ - Frontend

Frontend –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ—Ü–µ–Ω–∫–∏ –∑–≤–æ–Ω–∫–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö `calls_db`.

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend**: PHP 7.4+ (PDO –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å MySQL)
- **Frontend**: HTML5, CSS3, JavaScript (Vanilla JS)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: MySQL 5.7+ / MariaDB 10.3+

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
MORDA/
‚îú‚îÄ‚îÄ api/                          # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ calls.php                 # –°–ø–∏—Å–æ–∫ –∑–≤–æ–Ω–∫–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ call_details.php          # –î–µ—Ç–∞–ª–∏ –∑–≤–æ–Ω–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ filters.php               # –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ audio_stream.php          # –°—Ç—Ä–∏–º–∏–Ω–≥ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ assets/                       # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ style.css             # –°—Ç–∏–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îú‚îÄ‚îÄ calls_list.js         # JS –¥–ª—è —Å–ø–∏—Å–∫–∞ –∑–≤–æ–Ω–∫–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ call_evaluation.js    # JS –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ü–µ–Ω–∫–∏
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ database.php              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î
‚îú‚îÄ‚îÄ index.php                     # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Å–ø–∏—Å–æ–∫ –∑–≤–æ–Ω–∫–æ–≤)
‚îú‚îÄ‚îÄ call_evaluation.php           # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ü–µ–Ω–∫–∏ –∑–≤–æ–Ω–∫–∞
‚îî‚îÄ‚îÄ README.md                     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 7.4 –∏–ª–∏ –≤—ã—à–µ
- MySQL 5.7 –∏–ª–∏ –≤—ã—à–µ (–∏–ª–∏ MariaDB 10.3+)
- Web-—Å–µ—Ä–≤–µ—Ä (Apache / Nginx)
- PDO —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è PHP

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤ `config/database.php`:

```php
// –£–¥–∞–ª–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–æ—Å–Ω–æ–≤–Ω–æ–µ)
Host: 195.239.161.77
Port: 13306
Database: calls_db
Username: datalens_user
Password: datalens_readonly_2024

// –õ–æ–∫–∞–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (fallback)
Host: localhost
Port: 3306
Database: calls_db
Username: datalens_user
Password: datalens_readonly_2024
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ web-—Å–µ—Ä–≤–µ—Ä–∞

#### Apache

–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ö–æ—Å—Ç:

```apache
<VirtualHost *:80>
    ServerName calls.local
    DocumentRoot /path/to/MORDA

    <Directory /path/to/MORDA>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/calls_error.log
    CustomLog ${APACHE_LOG_DIR}/calls_access.log combined
</VirtualHost>
```

#### Nginx

```nginx
server {
    listen 80;
    server_name calls.local;
    root /path/to/MORDA;
    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

### 4. –ó–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä PHP)

–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä PHP:

```bash
cd /path/to/MORDA
php -S localhost:8000
```

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:8000`

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–∏—Å–∫–∞ –∑–≤–æ–Ω–∫–æ–≤ (`index.php`)

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ –∑–≤–æ–Ω–∫–∞–º–∏
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ:
  - –û—Ç–¥–µ–ª—É
  - –ú–µ–Ω–µ–¥–∂–µ—Ä—É
  - –î–∞—Ç–µ (–æ—Ç/–¥–æ)
  - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–º–∏–Ω/–º–∞–∫—Å)
  - –ù–æ–º–µ—Ä—É –∫–ª–∏–µ–Ω—Ç–∞
  - –û—Ü–µ–Ω–∫–µ (script_compliance_score)
  - –¢–∏–ø—É –∑–≤–æ–Ω–∫–∞ (first_call / other)
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º (–¥–∞—Ç–∞, –º–µ–Ω–µ–¥–∂–µ—Ä, –æ—Ç–¥–µ–ª, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –æ—Ü–µ–Ω–∫–∞)
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è (20 –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≤—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤, –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ)

**API endpoint:** `api/calls.php`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
```
GET /api/calls.php?department=–û—Ç–¥–µ–ª&manager=–ò–≤–∞–Ω–æ–≤&date_from=2025-10-01&page=1&sort_by=started_at_utc&sort_order=DESC
```

### 2. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ü–µ–Ω–∫–∏ –∑–≤–æ–Ω–∫–∞ (`call_evaluation.php`)

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–≤–æ–Ω–∫–µ (–¥–∞—Ç–∞, –º–µ–Ω–µ–¥–∂–µ—Ä, –æ—Ç–¥–µ–ª, –∫–ª–∏–µ–Ω—Ç, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- ‚úÖ –ê—É–¥–∏–æ–ø–ª–µ–µ—Ä —Å:
  - –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ/–ø–∞—É–∑–∞
  - –ü–µ—Ä–µ–º–æ—Ç–∫–∞ (seek bar)
  - –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ / –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Range –∑–∞–ø—Ä–æ—Å–æ–≤ (–¥–ª—è –ø–µ—Ä–µ–º–æ—Ç–∫–∏)
- ‚úÖ –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Å –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–µ–π:
  - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ø–∏–∫–µ—Ä–∞–º (–ú–µ–Ω–µ–¥–∂–µ—Ä / –ö–ª–∏–µ–Ω—Ç)
  - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
  - –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å–∏–Ω–∏–π - –º–µ–Ω–µ–¥–∂–µ—Ä, –∑–µ–ª–µ–Ω—ã–π - –∫–ª–∏–µ–Ω—Ç)
- ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏ (–¥–ª—è first_call):
  - –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤—ã—è—Å–Ω–µ–Ω–æ
  - –§–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã –≤—ã—è—Å–Ω–µ–Ω–∞
  - –¶–µ–ª—å –ø–æ–∫—É–ø–∫–∏ –≤—ã—è—Å–Ω–µ–Ω–∞
  - –ú–µ—Å—Ç–Ω—ã–π –ª–∏ –∫–ª–∏–µ–Ω—Ç
  - –ë—é–¥–∂–µ—Ç –≤—ã—è—Å–Ω–µ–Ω
  - –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ (%)
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã AI-–∞–Ω–∞–ª–∏–∑–∞:
  - –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
  - –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–≤–æ–Ω–∫–∞ (–ø–æ–∫–∞–∑ / –ø–µ—Ä–µ–∑–≤–æ–Ω / –æ—Ç–∫–∞–∑)
  - –ü—Ä–∏—á–∏–Ω–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏/–Ω–µ—É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
  - –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞
  - –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ LLM

**API endpoints:**
- `api/call_details.php?callid=xxx` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–∞
- `api/audio_stream.php?callid=xxx` - —Å—Ç—Ä–∏–º–∏–Ω–≥ –∞—É–¥–∏–æ

## üé® –î–∏–∑–∞–π–Ω

–î–∏–∑–∞–π–Ω –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ Figma –º–∞–∫–µ—Ç–∞—Ö:
- [–°–ø–∏—Å–æ–∫ –∑–≤–æ–Ω–∫–æ–≤](https://www.figma.com/design/CmdpfFmm4Kv8nWrHp8TA88/Untitled?node-id=1-1492&t=W9RnZl6HM4vuh7qj-4)
- [–°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ü–µ–Ω–∫–∏](https://www.figma.com/design/CmdpfFmm4Kv8nWrHp8TA88/Untitled?node-id=1-2144&t=W9RnZl6HM4vuh7qj-4)

**–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:**
- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç: `#2563eb` (—Å–∏–Ω–∏–π)
- –£—Å–ø–µ—Ö: `#10b981` (–∑–µ–ª–µ–Ω—ã–π)
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: `#f59e0b` (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
- –û—à–∏–±–∫–∞: `#ef4444` (–∫—Ä–∞—Å–Ω—ã–π)
- –§–æ–Ω: `#f8fafc` (—Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π)

## üîç –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

1. **`calls_raw`** - –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–≤–æ–Ω–∫–æ–≤
   - `callid` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–≤–æ–Ω–∫–∞
   - `started_at_utc` - –î–∞—Ç–∞/–≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞
   - `employee_name` - –ò–º—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞
   - `department` - –û—Ç–¥–µ–ª
   - `client_phone` - –¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞
   - `duration_sec` - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫—É–Ω–¥—ã)
   - `direction` - –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (INBOUND/OUTBOUND/MISSED)

2. **`audio_jobs`** - –ó–∞–¥–∞—á–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∞—É–¥–∏–æ
   - `callid` - ID –∑–≤–æ–Ω–∫–∞
   - `local_path` - –ü—É—Ç—å –∫ –∞—É–¥–∏–æ—Ñ–∞–π–ª—É
   - `status` - –°—Ç–∞—Ç—É—Å (DONE/ERROR/QUEUED)
   - `file_format` - –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ (mp3/wav)

3. **`transcripts`** - –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –∑–≤–æ–Ω–∫–æ–≤
   - `callid` - ID –∑–≤–æ–Ω–∫–∞
   - `text` - –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
   - `diarization_json` - JSON —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π —Å–ø–∏–∫–µ—Ä–æ–≤

4. **`analysis_results`** - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã AI-–∞–Ω–∞–ª–∏–∑–∞
   - `callid` - ID –∑–≤–æ–Ω–∫–∞
   - `call_type` - –¢–∏–ø –∑–≤–æ–Ω–∫–∞ (first_call/other)
   - `summary_text` - –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
   - `call_result` - –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–≤–æ–Ω–∫–∞
   - `is_successful` - –§–ª–∞–≥ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
   - `script_compliance_score` - –û—Ü–µ–Ω–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ (0-1)
   - `script_check_*` - –ü–æ–ª—è —á–µ–∫–ª–∏—Å—Ç–∞

## üìä API Endpoints

### 1. GET `/api/calls.php`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–≤–æ–Ω–∫–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `department` - –û—Ç–¥–µ–ª (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `manager` - –ú–µ–Ω–µ–¥–∂–µ—Ä (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –ø–æ–∏—Å–∫ –ø–æ LIKE)
- `date_from` - –î–∞—Ç–∞ –æ—Ç (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD)
- `date_to` - –î–∞—Ç–∞ –¥–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD)
- `duration_min` - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫—É–Ω–¥—ã)
- `duration_max` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫—É–Ω–¥—ã)
- `client_phone` - –ù–æ–º–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –ø–æ–∏—Å–∫ –ø–æ LIKE)
- `rating_min` - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ (0-1)
- `rating_max` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ (0-1)
- `call_type` - –¢–∏–ø –∑–≤–æ–Ω–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `page` - –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
- `per_page` - –ó–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20, –º–∞–∫—Å 100)
- `sort_by` - –ü–æ–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (started_at_utc, employee_name, department, duration_sec, script_compliance_score)
- `sort_order` - –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (ASC/DESC, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é DESC)

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": [
    {
      "callid": "xxx",
      "client_phone": "+79001234567",
      "employee_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω",
      "department": "–û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂",
      "direction": "INBOUND",
      "duration_sec": 180,
      "started_at_utc": "2025-10-03 10:30:00",
      "call_type": "first_call",
      "summary_text": "–ö–ª–∏–µ–Ω—Ç –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è –∫–≤–∞—Ä—Ç–∏—Ä–æ–π...",
      "call_result": "–ù–∞–∑–Ω–∞—á–µ–Ω –ø–æ–∫–∞–∑",
      "is_successful": true,
      "script_compliance_score": 0.85
    }
  ],
  "pagination": {
    "total": 4296,
    "page": 1,
    "per_page": 20,
    "total_pages": 215
  }
}
```

### 2. GET `/api/call_details.php?callid=xxx`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–≤–æ–Ω–∫–µ

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `callid` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - ID –∑–≤–æ–Ω–∫–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "callid": "xxx",
    "employee_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω",
    "department": "–û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂",
    "client_phone": "+79001234567",
    "duration_sec": 180,
    "started_at_utc": "2025-10-03 10:30:00",
    "direction": "INBOUND",
    "transcript_text": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç...",
    "diarization": {
      "segments": [
        {
          "start": 0.0,
          "end": 11.2,
          "speaker": "SPEAKER_00",
          "speaker_role": "–ú–µ–Ω–µ–¥–∂–µ—Ä",
          "text": "–ê–ª–ª–æ, –¥–æ–±—Ä—ã–π –¥–µ–Ω—å!"
        }
      ]
    },
    "call_type": "first_call",
    "summary_text": "–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ...",
    "call_result": "–ù–∞–∑–Ω–∞—á–µ–Ω –ø–æ–∫–∞–∑",
    "is_successful": true,
    "script_compliance_score": 0.85,
    "script_check_location": true,
    "script_check_payment": true,
    "checklist": [
      {
        "id": "location",
        "label": "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤—ã—è—Å–Ω–µ–Ω–æ",
        "checked": true,
        "description": "..."
      }
    ]
  }
}
```

### 3. GET `/api/filters.php`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "departments": ["–û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂", "–û—Ç–¥–µ–ª –∞—Ä–µ–Ω–¥—ã"],
    "managers": ["–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω", "–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä"],
    "call_types": ["first_call", "other"]
  }
}
```

### 4. GET `/api/audio_stream.php?callid=xxx`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°—Ç—Ä–∏–º–∏–Ω–≥ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞ –∑–≤–æ–Ω–∫–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `callid` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - ID –∑–≤–æ–Ω–∫–∞

**–û—Ç–≤–µ—Ç:** –ë–∏–Ω–∞—Ä–Ω—ã–π –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫ (Content-Type: audio/mpeg)

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:**
- Range –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–µ—Ä–µ–º–æ—Ç–∫–∏
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ MIME —Ç–∏–ø–∞ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É —Ñ–∞–π–ª–∞

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

```php
<?php
include_once 'config/database.php';
$database = new Database();
$db = $database->getConnection();

if ($db) {
    echo "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ";

    // –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
    $stmt = $db->prepare("SELECT COUNT(*) as total FROM calls_raw");
    $stmt->execute();
    $result = $stmt->fetch();
    echo "<br>üìû –í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤: " . $result['total'];
} else {
    echo "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è";
}
?>
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

–í–∫–ª—é—á–∏—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ PHP –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

```php
// –í –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ index.php
error_reporting(E_ALL);
ini_set('display_errors', 1);
```

## üöÄ Production —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–û—Ç–∫–ª—é—á–∏—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫:**
   ```php
   error_reporting(0);
   ini_set('display_errors', 0);
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS** (–µ—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ –¥—Ä—É–≥–æ–º –¥–æ–º–µ–Ω–µ):
   ```php
   header("Access-Control-Allow-Origin: https://yourdomain.com");
   ```

3. **–î–æ–±–∞–≤—å—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è filters.php:
   ```php
   header("Cache-Control: public, max-age=3600");
   ```

4. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∞—É–¥–∏–æ** (–¥–æ–±–∞–≤—å—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é):
   ```php
   // –í audio_stream.php
   if (!isset($_SESSION['user_id'])) {
       http_response_code(401);
       exit();
   }
   ```

5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ prepared statements** (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

6. **–î–æ–±–∞–≤—å—Ç–µ rate limiting** –¥–ª—è API endpoints

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω–æ–µ –ü–û. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.

## üë• –ê–≤—Ç–æ—Ä—ã

- Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞: Claude AI
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: calls_db (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- –î–∏–∑–∞–π–Ω: –†–æ–º–∞ –ß–µ—á—É–ª–∏–Ω (Figma –º–∞–∫–µ—Ç—ã)
