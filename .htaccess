RewriteEngine On
RewriteBase /

# Exclude .well-known directory (for Let's Encrypt SSL validation)
RewriteCond %{REQUEST_URI} ^/\.well-known/
RewriteRule ^ - [L]

# Редирект с /index_new.php на / (если кто-то зайдет напрямую)
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s/+index_new\.php[?\s]
RewriteRule ^index_new\.php$ / [R=301,L]

# Внутренний rewrite с / на index_new.php (без редиректа)
RewriteCond %{REQUEST_URI} ^/$
RewriteRule ^$ /index_new.php [L]

# Exclude API directory from rewriting (let PHP files execute directly)
RewriteCond %{REQUEST_URI} ^/api/
RewriteRule ^ - [L]

# Exclude webhook directory from rewriting (allow external services to POST data)
RewriteCond %{REQUEST_URI} ^/webhook/
RewriteRule ^ - [L]

# Remove .php extension from URLs
# Redirect requests with .php extension to without it
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s([^.]+)\.php [NC]
RewriteRule ^ %1 [R=301,L]

# Если файл или директория существует, отдаём его напрямую
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Try to serve as PHP file if it exists
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.*)$ $1.php [L]

# Всё остальное направляем на index_new.php
RewriteRule ^(.*)$ /index_new.php [L,QSA]
