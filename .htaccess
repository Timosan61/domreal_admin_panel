RewriteEngine On
RewriteBase /

# Редирект с /index_new.php на / (если кто-то зайдет напрямую)
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s/+index_new\.php[?\s]
RewriteRule ^index_new\.php$ / [R=301,L]

# Внутренний rewrite с / на index_new.php (без редиректа)
RewriteCond %{REQUEST_URI} ^/$
RewriteRule ^$ /index_new.php [L]

# Exclude API directory from rewriting (let PHP files execute directly)
RewriteCond %{REQUEST_URI} ^/api/
RewriteRule ^ - [L]

# Exclude webhook directory from rewriting (allow external services to POST data)
RewriteCond %{REQUEST_URI} ^/webhook/
RewriteRule ^ - [L]

# Если файл или директория существует, отдаём его напрямую
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Всё остальное направляем на index_new.php
RewriteRule ^(.*)$ /index_new.php [L,QSA]
