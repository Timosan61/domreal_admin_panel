<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ - Network Monitor</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .log { background: white; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        button { padding: 10px 20px; margin: 5px; font-size: 14px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç Money Tracker Pagination</h1>

    <div>
        <button onclick="testPage(1)">–¢–µ—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 1</button>
        <button onclick="testPage(10)">–¢–µ—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 10</button>
        <button onclick="testPage(50)">–¢–µ—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 50</button>
        <button onclick="testMultipleClicks()">–¢–µ—Å—Ç: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª–∏–∫–∏ (–±–∞–≥?)</button>
    </div>

    <div id="log"></div>

    <script>
        let requestCounter = 0;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.insertBefore(entry, logDiv.firstChild);
        }

        async function testPage(pageNum) {
            requestCounter++;
            const reqId = requestCounter;

            log(`üöÄ [–ó–∞–ø—Ä–æ—Å #${reqId}] –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${pageNum}...`, 'info');

            const params = new URLSearchParams({
                page: pageNum,
                per_page: 50,
                sort_by: 'created_at',
                sort_order: 'DESC'
            });

            const url = `/admin_panel/api/enrichment_data.php?${params.toString()}`;

            const startTime = performance.now();

            try {
                const response = await fetch(url, {
                    credentials: 'same-origin'
                });

                const elapsed = Math.round(performance.now() - startTime);

                if (!response.ok) {
                    log(`‚ùå [–ó–∞–ø—Ä–æ—Å #${reqId}] HTTP error: ${response.status} (${elapsed}ms)`, 'error');
                    return;
                }

                const data = await response.json();

                if (data.success) {
                    log(`‚úÖ [–ó–∞–ø—Ä–æ—Å #${reqId}] –£—Å–ø–µ—à–Ω–æ: ${data.data.length} –∑–∞–ø–∏—Å–µ–π, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ${data.pagination.page}/${data.pagination.total_pages} (${elapsed}ms)`, 'success');
                } else {
                    log(`‚ùå [–ó–∞–ø—Ä–æ—Å #${reqId}] –û—à–∏–±–∫–∞: ${data.error} (${elapsed}ms)`, 'error');
                }

            } catch (error) {
                const elapsed = Math.round(performance.now() - startTime);
                log(`‚ùå [–ó–∞–ø—Ä–æ—Å #${reqId}] –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message} (${elapsed}ms)`, 'error');
            }
        }

        // –¢–µ—Å—Ç: –±—ã—Å—Ç—Ä—ã–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª–∏–∫–∏ (–≤–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –∑–∞–≤–∏—Å–∞–Ω–∏—è)
        async function testMultipleClicks() {
            log(`‚ö†Ô∏è –¢–µ—Å—Ç: 10 –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–¥—Ä—è–¥ (–∏–º–∏—Ç–∞—Ü–∏—è –±–∞–≥–æ–≤ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞)`, 'info');
            for (let i = 0; i < 10; i++) {
                testPage(i + 1);
                await new Promise(r => setTimeout(r, 100)); // 100ms –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
            }
        }

        log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∞.', 'success');
    </script>
</body>
</html>
